---
title: Denotational Semantics of Typed Lambda Calculus IV — CPO Model for PCF
date: 2024-07-11 9:09:00 +500
math: true
categories: [Theory, Programming Language]
tags: [note, lang-en, PL]
---

In this article, we consider the domain-theoretic semantics of PCF. This provides some insight into properties of CPOs, and also provides the basis for semantic reasoning about PCF.

We show soundness of the PCF equational axioms system, and therefore the reduction rules, for our CPO model, called $\mathcal{A}_{\text{PCF}}$. It is impossible for the PCF equational proof system to be complete for proving all equations between PCF terms that hold in PCF. The reason is that, as shown in [*Easy Foundations for Programming Languages V — PCF Iteration and Recursion*]({{site.url}}/posts/easy_PL5/#partial-recursive-function), every partial recursive function is definable in PCF.

By soundness, and the fact that all the numerals denote distinct elements of the model, two expressions of type $nat \to nat$ will be equal in PCF iff they operationally define the same partial recursive function. Since equality between partial recursive functions is not recursively enumerable, no recursive axiom system could be complete for $\mathcal{A}_{\text{PCF}}$. In the next article, we will consider an extension to the equational axiom system, based on the CPO model, that proves more properties of terms.

## CPO Model for PCF

The model $$\mathcal{A}_{\text{PCF}}$$ is the full continuous hierarchy over $$\mathcal{A}_{\text{PCF}}^{nat} = \mathbb{N}_\perp$$ and $$\mathcal{A}_{\text{PCF}}^{bool} = \mathbb{B}_\perp$$, with constants of PCF interpreted as described below.

Since the type constants of PCF are interpreted as pointed CPOs, and cartesian product and continuous function constractors preserve pointedness, all of the type of PCF are interpreted as pointed CPOs. This gives us least-fixed-point operators at all types, allowing us to interpret the fixed-point constants of PCF according to [Lemma 1]({{site.url}}/posts/model3/#fixed-points-and-the-full-continuous-hierarchy) in the last article.

We interpret constants $0, 1, 2, ...$ and $true,false$ as the standard natural numbers and boolean elements of the lifted set $$\mathbb{N}_\perp$$ and $$\mathbb{B}_\perp$$. If we choose continuous functions for basic PCF operations $+$, $Eq?$ and conditional, then every term of PCF will have a meaning in $\mathcal{A}_{\text{PCF}}$.

We interpret $+$ and $Eq?$ in $$\mathcal{A}_{\text{PCF}}$$ as the lifted versions, $$+_\perp$$ and $$Eq?_\perp$$, of the standard functions. In other words, we interpret $+$ as the extension of addition that is strict in both arguments, so that for every $x \in \mathcal{A}_{\text{PCF}}^{nat}$,

$$\perp_{nat} + x = x + \perp_{nat} = \perp_{nat}$$

We treat the PCF equality test similarly, so that the PCF expression $$Eq? \: M \: N$$ has value $true$ if $M$ and $N$ denote the same element of $$\mathbb{N}_\perp$$ different from $\perp$, value $false$ if $M$ and $N$ denote different non-$\perp$ elements of $$\mathbb{N}_\perp$$, and value $\perp$ if either $M$ and $N$ denotes $\perp$.

The interpretation of conditional in $\mathcal{A}_{\text{PCF}}$ is a little subtle. You may guess that we could also interpret conditional as a strict function, with value $\perp$ of the appropriate type whenever any of its arguments is $\perp$ of some type. However, this does not work, since in the case that $M$ denotes $\perp$ but $N$ does not, we would have

$$\text{if } false \text{ then } M \text{ else } N \:=\:\: \perp,$$

which contradicts an equational axiom of PCF.

> Recall that we have the following equational axioms for conditional discussed in [*Easy Foundations for Programming Languages III — The Language PCF & Its Syntax*]({{site.url}}/posts/easy_PL3/#booleans-and-natural-numbers).  
$$
\begin{split}
(\text{if } true \text{ then } M \text{ else } N) = M \\
(\text{if } false \text{ then } M \text{ else } N) = N
\end{split}
$$
{: .prompt-tip}

An interpretation of conditional that satisfies the equational axioms of PCF is the following.

$$
\mathcal{A}_{\text{PCF}} [\![\text{if } P \text{ then } M \text{ else } N]\!]\eta = 
\begin{cases}
\mathcal{A}_{\text{PCF}} [\![M]\!]\eta & \text{if } \mathcal{A}_{\text{PCF}} [\![P]\!]\eta = true \\
\mathcal{A}_{\text{PCF}} [\![N]\!]\eta & \text{if } \mathcal{A}_{\text{PCF}} [\![P]\!]\eta = false \\
\perp & \text{otherwise}
\end{cases}
$$

Since the equational axioms of PCF only mention conditional expressions when the first argument is $true$ or $false$, it is easy to see that the axioms are satisfied. This completes the definition of $\mathcal{A}_{\text{PCF}}$.

Now we have the following immediate consequences of the general soundness theorem for Henkin models.

**(Theorem 1.)** Let $M$ and $N$ be expressions of PCF over typed variables from $\Gamma$. If $$\Gamma \: \triangleright \: M=N :\sigma$$ is provable from the axioms for PCF, then the CPO model $\mathcal{A}_\text{PCF}$ satisfies the equation $$\Gamma \: \triangleright \: M=N :\sigma$$.

**(Corollary 1.)** If $$\Gamma \: \triangleright \: M :\sigma$$ is a well-typed term of PCF, and $M \twoheadrightarrow N$, then the CPO model $\mathcal{A}_\text{PCF}$ satisfies the equation $$\Gamma \: \triangleright \: M=N :\sigma$$.

These soundness results show that the denotational semantics given by $$\mathcal{A}_\text{PCF}$$ has the minimal properties required of any denotational semantics. Specifically, if we can prove $M=N$, or reduce one term to the other, then these two terms will have the same meaning in $$\mathcal{A}_\text{PCF}$$. It follows that if two terms have different meaning, then we cannot prove them equal or reduce one to the other. Therefore, we can use $$\mathcal{A}_\text{PCF}$$ to reason about unprovability or the non-existence of reductions.

## Examples

In the this section, we will use two example to illustrate how to work out the meaning of some expressions in $\mathcal{A}_\text{PCF}$ and make some comment about the difference between the least fixed point of a function and other fixed points.

### Ex.1 Factorial Function

Recall that the factorial function may be written $$fact \: \stackrel{\text{def}}{=} \: fix_{nat \to nat} \: F$$, where $F$ is the expression

$$ F \: \stackrel{\text{def}}{=} \: \lambda f:nat \rightarrow nat .\: \lambda y:nat .\: (\text{if } Eq? \: y \: 0 \text{ then } 1 \text{ else } y*f\:(y-1)).$$

We will work out the meaning of this closed term assuming that $\ast$ and $-$ denote multiplication and substraction functions which are strict extensions of the standard ones. In other words, we assume that multiplication and substraction have their standard meaning on non-least element of $$\mathbb{N}_\perp$$, but have value $\perp$ if either of their arguments is $\perp$.

Following the definition of $fix$ in a CPO, we can see that the meaning of factorial is the least upper bound of a directed set. Specifically, $$\mathcal{A}_\text{PCF}[\![fact]\!] $$ is the least upper bound $$\bigvee \{ \bar{F}^n(\perp) \mid n \geq 0 \}$$, where $$\bar{F} = \mathcal{A}_\text{PCF}[\![F]\!]$$. We will work out the first few cases of $\bar{F}^n(\perp)$ to understand what this means.

Since all of the lambda terms involved are closed, we will dispense with the formality of writing $$\mathcal{A}_\text{PCF}[\![\:]\!]$$ and use lambda terms as names for elements of the appropriate domains.

$$
\begin{split}
\bar{F}^0 (\perp) &= \perp_{nat \to nat} \\\\

\bar{F}^1 (\perp) &= \lambda y:nat.\: \text{ if } Eq? \: y \: 0 \text{ then } 1 \text{ else } y*(\bar{F}^0 (\perp))\:(y-1) \\
&= \lambda y:nat.\: \text{ if } Eq? \: y \: 0 \text{ then } 1 \text{ else } y*(\perp_{nat \to nat})\:(y-1) \\
&= \lambda y:nat.\: \text{ if } Eq? \: y \: 0 \text{ then } 1 \text{ else } \perp_{nat}  \\\\

\bar{F}^2 (\perp) &= \lambda y:nat.\: \text{ if } Eq? \: y \: 0 \text{ then } 1 \text{ else } y*(\bar{F}^1 (\perp))\:(y-1) \\
&= \lambda y:nat.\: \text{ if } Eq? \: y \: 0 \text{ then } 1 \text{ else } y*\\
&\quad \quad (\lambda x:nat.\: \text{ if } Eq? \: x \: 0 \text{ then } 1 \text{ else } \perp_{nat})\:(y-1) \\
&= \lambda y:nat.\: \text{ if } Eq? \: y \: 0 \text{ then } 1 \text{ else } y*\\
&\quad \quad (\text{ if } Eq? \: (y-1) \: 0 \text{ then } 1 \text{ else } \perp_{nat}) \\
\end{split}
$$

Continuing in this way, we can see that $\bar{F}^n (\perp)$ is the function which computes $y!$ whenever $0 \leq y < n$ and has value $\perp_{nat}$ otherwise. Since $\perp_{nat}$ represents "undefined," this means that $\bar{F}^n (\perp)$ is defined for $0 \leq y < n$ and undefined otherwise.

A property of this collection of functions is that for a particular argument $y \neq \perp$, there are two possible values for $$\bar{F}^n (\perp) \: y$$ — if $n \leq y$, then the value is $\perp$, while if $n > y$, the value is $y!$. 

As spelled out in the statement of [Lemma 4]({{site.url}}/posts/model2/#functions-as-cpo) in the CPO article, the least upper bound of $$\{ \bar{F}^n (\perp) \mid n \geq 0 \}$$ is the function mapping any $$y \in \mathbb{N}_\perp$$ to the least upper bound of the set $$\{ \bar{F}^n (\perp)\:y \mid n \geq 0 \}$$. The set contains only $\perp$, if $y = \perp$, and has two elements $\perp$ and $y!$ otherwise. Therefore $$\mathcal{A}_\text{PCF}[\![fact]\!]$$ is the function from $$\mathbb{N}_\perp$$ to $$\mathbb{N}_\perp$$ which maps $\perp$ to $\perp$, and any other $y \in \mathbb{N}$ to $y!$. 

Such strictness of factorial agrees with our computational intuition and experience, since we do not expect any computation of $fact$ $M$ to terminate if the expression $M$ cannot be simplified to a numeral. But in the case $M$ reduces to a numeral for $y$, we can reduce $fact$ $M$ to the numeral for $y!$.

> In general, the least fixed point of a function is the fixed point that is "computed in practice." Later we will formally show that the PCF operational and denotational semantics coincide. Simply put, the least fixed point of a function $f$ has all the properties of $fix$ $f$ that we can determine by applying $fix$-reduction some number of times.
{: .prompt-tip}


### Ex.2 Function with Many Fixed Points

This example illustrates the difference between the least fixed point of a function and other fixed point.

Consider the function $F:(nat \to nat) \to (nat \to nat)$ defined by 

$$ F \: \stackrel{\text{def}}{=} \: \lambda f:nat \rightarrow nat .\: \lambda x:nat .\: (\text{if } Eq? \: x \: 1 \text{ then } 1 \text{ else } f\:(x-2))$$

where substraction $x-y$ yields $0$ if $y \geq x$. 

In contrast to the function used to define factorial, we will see that $F$ has many fixed points. The reason is that $F$ is a function mapping even arguments to $\perp$. This allows us to find greater fixed points (in the point-wise order) which map even arguments to natural numbers other than $\perp$.

Before discussing alternate fixed points further, we will work out the meaning of $fix$ $F$.

As in factorial, we let $$\bar{F} = \mathcal{A}_\text{PCF}[\![F]\!]$$. The least fixed point of $\bar{F}$ is the least upper bound of the set $$\{ \bar{F}^n (\perp) \mid n \geq 0 \}$$. The simplest way to understand this set is to begin by working out the first few functions.

$$
\begin{split}
\bar{F}^0(\perp) &= \perp_{nat \to nat} \\\\

\bar{F}^1(\perp) &= \lambda x:nat .\: \text{if } Eq? \: x \: 1 \text{ then } 1 \text{ else } (\bar{F}^0(\perp))\:(x-2)\\
&= \lambda x:nat .\: \text{if } Eq? \: x \: 1 \text{ then } 1 \text{ else } \perp_{nat} \\\\

\bar{F}^2(\perp) &= \lambda x:nat .\: \text{if } Eq? \: x \: 1 \text{ then } 1 \text{ else } (\bar{F}^1(\perp))\:(x-2)\\
&= \lambda x:nat .\: \text{if } Eq? \: x \: 1 \text{ then } 1 \text{ else } \\
& \quad \quad (\lambda y:nat .\: \text{if } Eq? \: y \: 1 \text{ then } 1 \text{ else } \perp_{nat})\:(x-2)\\
&= \lambda x:nat .\: \text{if } Eq? \: x \: 1 \text{ then } 1 \text{ else } \\
& \quad \quad (\text{if } Eq? \: (x-2) \: 1 \text{ then } 1 \text{ else } \perp_{nat})\\
\end{split}
$$

Continuing in this way, we can see that $$\bar{F}^n (\perp)$$ is the function which maps any odd $x < 2n$ to $1$ and has value $$\perp_{nat}$$ otherwise. The least upper bound $f$ of all such functions is the function mapping all odd $x$ to $1$, and any other natural number to $\perp$. 

This corresponds to the fact that if we try to compute the value of $$(fix \: F) \: x$$ by reduction, we will succeed after a finite number of reduction steps iff $x$ is odd. If $x$ is even, we can reduce the expression indefinitely, but will never produce a numeral.

It is not hard to see that the fixed points of $F$ above are precisely the functions $g:nat \to nat$ satisfying the two conditions:

$$
\begin{split}
g(1) &= 1\\
g(x+2) &= g(x)
\end{split}
$$

Since these two equations do not determine a value for even $x$, any function mapping all even $x$ (and $0$) to some number $n$ will be a fixed point of $F$. All of these alternatives are greater than $f$ since any natural numebr $n$ is greater than $\perp$ in the ordering on the lifted CPO of natural numebrs. However, none of these alternative fixed points is the function computed by reduction.

